<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/assets/js/spin.js"></script>
<script src="/assets/js/jquery.spin.js"></script>
<link href="/assets/css/font-awesome.css" rel="stylesheet" />
<link href="/assets/css/custom.css" rel="stylesheet" />
<link href="/assets/css/IconicIcons.css" rel="stylesheet" />
<link href="/assets/css/font-mfizz.css" rel="stylesheet" />
<link href="/assets/css/loversquarrel.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro|PT+Sans|PT+Sans+Narrow|PT+Serif+Caption|PT+Mono|PT+Serif|Source+Code+Pro|Raleway|Raleway+Dots|PT+Sans+Caption' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lato:400italic' rel='stylesheet' type='text/css'>
<title>BTK, A tool for reading C3d files &#8211; Kumarcode</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="BTK, A tool for reading C3d files">
<meta property="og:description" content="A stylish blog on my code">
<meta property="og:url" content="/BTK-biomechanics/">
<meta property="og:site_name" content="Kumarcode">





<link rel="canonical" href="/BTK-biomechanics/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kumarcode Feed">
<link rel="author" href="http://plus.google.com/+/u/0/104266827599169158890/posts?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<span id="titlename"><a href="/"><i class="fa fa-code"></i>Kumarcode</a></span>
			<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#titlename").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#titlename").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<span class="About" id="1"> <li><a href="/about/" ><i class="fa fa-user" id="1"></i>&nbsp;About</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#1").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#1").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
				<span class="Posts" id="2"> <li><a href="/posts/" ><i class="fa fa-bars" id="2"></i>&nbsp;Posts</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#2").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#2").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
				<span class="Arch Linux" id="3"> <li><a href="/arch/" ><i class="icon-arch" id="3"></i>&nbsp;Arch Linux</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#3").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#3").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
				<span class="Gardening" id="4"> <li><a href="/gardening/" ><i class="fa fa-leaf" id="4"></i>&nbsp;Gardening</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#4").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#4").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
				<span class="music" id="5"> <li><a href="/music/" ><i class="fa fa-music" id="5"></i>&nbsp;music</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#5").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#5").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
				<span class="PUNS" id="6"> <li><a href="/puns/" ><i class="fa fa-comments-o" id="6"></i>&nbsp;PUNS</a></li></span>
				<script type="text/javascript">
					$( document ).ready(function() {



         				
							$("#6").mouseover(function(){
								$(this).find("i").addClass("tospin");
							});

							$("#6").mouseout(function(){
								$(this).find("i").removeClass("tospin");
							});

							   							



					});	

</script>

		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->






<div id="main" role="main">
  <div class="article-author-side">
    
	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Nikhil Kumar bio photo"></a>

<h3>Nikhil Kumar</h3>
<span class="siteBio">A stylish blog on my code<br><br></span>


<a href="http://plus.google.com//u/0/104266827599169158890/posts" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="mailto:nikhilkumar516@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope"></i> Gmail</a>




<a href="http://github.com/nikhil" class="author-social" target="_blank"><i class="fa fa-github-square"></i> Github</a>







  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="/BTK-biomechanics/" rel="bookmark" title="BTK, A tool for reading C3d files">BTK, A tool for reading C3d files</a></h1>
		<p class="byline"><time datetime="2014-05-21T00:00:00-04:00">May 21, 2014</time></p>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>I am currently doing research on the diffrences between Barefoot running and Shod running(running with shoes). I am working with software known as the <code>AnyBody Modeling System</code> using the <code>Gait lower Extremity model</code>. This allows me to input motion captured data, which is givin in the form of a <code>.c3d</code> file. However, I ran into a problem where I wanted to modify the .c3d file but I could not find anyt decent software to allow me to do this. I was able to find <code>btk</code> a <code>python</code> package that allows me to modify .c3d files.</p>

<h2 id="c3d-files">C3d files</h2>

<h3 id="what-are-c3d-files">What are c3d files:</h3>

<p>According to the c3d main page:</p>
<blockquote>
The C3D format is a public domain, binary file format that has been used in Biomechanics, Animation and Gait Analysis laboratories to record synchronized 3D and analog data since the mid 1980's.  It is supported by all 3D major Motion Capture System manufacturers, as well as other companies in the Biomechanics, Motion Capture and Animation Industries.<a href="http://www.c3d.org/"><i class="fa fa-file"></i></a></blockquote>

<h3 id="file-structure">File Structure</h3>
<p>The structure of the C3d file is as follows:</p>

<div class="highlight"><pre><code class="text"><span class="lineno"> 1</span> *.c3d/
<span class="lineno"> 2</span> 	├── Header
<span class="lineno"> 3</span> 	|    ├── File type
<span class="lineno"> 4</span> 	|    ├── Data type
<span class="lineno"> 5</span> 	|    ├── 3D Points
<span class="lineno"> 6</span> 	|    ├── Analog Channels
<span class="lineno"> 7</span> 	|    ├── First Frame
<span class="lineno"> 8</span> 	|    ├── Last Frame
<span class="lineno"> 9</span> 	|    ├── Start Record
<span class="lineno">10</span> 	|    ├── AV ratio
<span class="lineno">11</span> 	|    ├── Video rate
<span class="lineno">12</span> 	|    └── Max interpolation Gap
<span class="lineno">13</span> 	├── Events
<span class="lineno">14</span> 	├── Groups
<span class="lineno">15</span> 	|    |	├── Point
<span class="lineno">16</span> 	|    |	├── ...
<span class="lineno">17</span> 	|    |	├──Labels
<span class="lineno">18</span> 	|    |	└── ...
<span class="lineno">19</span> 	|    |
<span class="lineno">20</span> 	|    ├── Analog
<span class="lineno">21</span> 	|    ├── Seq
<span class="lineno">22</span> 	|    ├── Manufacturer
<span class="lineno">23</span> 	|    └── Force Platform
<span class="lineno">24</span> 	├── Analog data
<span class="lineno">25</span> 	└── Point data</code></pre></div>

<h2 id="instalation">Instalation</h2>

<h2 id="what-is-btk">What is Btk?</h2>
<p>According to the BTk site on google code:</p>
<blockquote>
BTK is an open-source and cross-platform library for biomechanical analysis. BTK read and write acquisition files and can modify them. All these operations can be done by the use of the C++ API or by the wrappers included (Matlab, Octave, and Python).<a href="https://code.google.com/p/b-tk/"><i class="fa fa-cogs"></i></a>
</blockquote>

<h2 id="python-packages-needed">Python packages needed</h2>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="n">numpy</span>
<span class="lineno">2</span> <span class="n">Matplotlib</span>
<span class="lineno">3</span> <span class="n">BTK</span></code></pre></div>

<p>To install python2 packages you need to run pip.
For example to install numpy, you need to run:</p>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span></code></pre></div>

<p class="notice"><i class="fa fa-warning"></i> <strong>Caution:</strong> BTK is the exception here. I was not able to get btk working through pip. BTK also seems to be architectural dependent as it was not installing in my ARCH distribution. </p>

<p>I was able to get it working on Fedora 19 by installing the python wrapper package from <a href="https://code.google.com/p/b-tk/"> here. </a></p>

<p>Then run:</p>

<div class="highlight"><pre><code class="bash"><span class="lineno">1</span> yum localinstall packagename.rpm</code></pre></div>

<h2 id="using-b-tk-to-modify-your-file">Using b-tk to modify your file</h2>

<p>You can import btk in python by specify your system path to the package or by
just using import depending on your installation.</p>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="lineno">2</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;path to your btk python package&quot;</span><span class="p">)</span>
<span class="lineno">3</span> <span class="kn">import</span> <span class="nn">btk</span></code></pre></div>

<p>You then need to create a btk reader.</p>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">btk</span><span class="o">.</span><span class="n">btkAcquisitionFileReader</span><span class="p">()</span></code></pre></div>

<p>Then you need to open the file and create a btk aquisition object.</p>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="n">reader</span><span class="o">.</span><span class="n">SetFilename</span><span class="p">(</span><span class="s">&quot;sample.c3d&quot;</span><span class="p">)</span> <span class="c"># open the c3d file</span>
<span class="lineno">2</span> <span class="n">reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="lineno">3</span> <span class="n">acq</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span> <span class="c"># creates a btk aquisition object</span></code></pre></div>

<p>You can then itterate through the Marker labels and Analog channels by doing:</p>

<div class="highlight"><pre><code class="python"><span class="lineno">1</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Marker labels:&#39;</span><span class="p">)</span>
<span class="lineno">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">acq</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetItemNumber</span><span class="p">()):</span>
<span class="lineno">3</span>     <span class="k">print</span><span class="p">(</span><span class="n">acq</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;  &#39;</span><span class="p">)</span>   
<span class="lineno">4</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Analog channels:&#39;</span><span class="p">)</span>
<span class="lineno">5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">acq</span><span class="o">.</span><span class="n">GetAnalogs</span><span class="p">()</span><span class="o">.</span><span class="n">GetItemNumber</span><span class="p">()):</span>
<span class="lineno">6</span>     <span class="k">print</span><span class="p">(</span><span class="n">acq</span><span class="o">.</span><span class="n">GetAnalog</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;  &#39;</span><span class="p">)</span></code></pre></div>

<p>You can then set the value in a new c3d file clone or the original c3d file useing the
<code>SetValue</code> method.
Here is some code I did to cut off the force at some value.</p>

<div class="highlight"><pre><code class="python"><span class="lineno"> 1</span> <span class="c">#modifies the values in the z axis 1st force plate</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="n">ana</span> <span class="o">=</span> <span class="n">clone</span><span class="o">.</span><span class="n">GetAnalog</span><span class="p">(</span><span class="s">&quot;Fz1&quot;</span><span class="p">)</span>
<span class="lineno"> 4</span> <span class="n">valz1</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">GetValues</span><span class="p">()</span>
<span class="lineno"> 5</span> <span class="n">scalez1</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">GetScale</span><span class="p">()</span>
<span class="lineno"> 6</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno"> 7</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="lineno"> 8</span> <span class="k">for</span> <span class="n">forcez1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">valz1</span><span class="p">):</span>
<span class="lineno"> 9</span>       <span class="k">if</span> <span class="n">forcez1</span><span class="o">/</span><span class="n">scalez1</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
<span class="lineno">10</span> 			<span class="n">ana</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">*</span> <span class="n">scalez1</span><span class="p">)</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>       <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span></code></pre></div>


      
      <footer role="contentinfo">
        <div class="article-author-bottom">
          
	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Nikhil Kumar bio photo"></a>

<h3>Nikhil Kumar</h3>
<span class="siteBio">A stylish blog on my code<br><br></span>


<a href="http://plus.google.com//u/0/104266827599169158890/posts" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="mailto:nikhilkumar516@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope"></i> Gmail</a>




<a href="http://github.com/nikhil" class="author-social" target="_blank"><i class="fa fa-github-square"></i> Github</a>







        </div>
 <!--       <p class="byline"><strong>BTK, A tool for reading C3d files</strong> was published
			on <time datetime="2014-05-21T00:00:00-04:00">May 21, 2014</time> by <a href="/about" title="About Nikhil Kumar">Nikhil Kumar</a>.</p> -->
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->







<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
			  rel:'  C3d File'
		   }).appendTo("pre:eq(0)");

});	

</script>

















<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Packages'
		   }).appendTo("pre:eq(1)");

});	

</script>







<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Bash'
		   }).appendTo("pre:eq(2)");

});	

</script>













<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Bash'
		   }).appendTo("pre:eq(3)");

});	

</script>

















<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Python'
		   }).appendTo("pre:eq(4)");

});	

</script>













<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Python'
		   }).appendTo("pre:eq(5)");

});	

</script>













<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Python'
		   }).appendTo("pre:eq(6)");

});	

</script>













<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Python'
		   }).appendTo("pre:eq(7)");

});	

</script>













<script type="text/javascript">
$( document ).ready(function() {
     
       $("pre").addClass("terminal");
	   
		 $("<span>",{
	       rel:'  Python'
		   }).appendTo("pre:eq(8)");

});	

</script>










<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/Designing-dynamicaly-generated-html/" title="Designing dyamically generated html from Jekyll">Designing dyamically generated html from Jekyll</a></li>
    
      <li><a href="/i3-tiling-window-manager/" title="i3 tiling window manager">i3 tiling window manager</a></li>
    
      <li><a href="/Github-Name-Squatting-Policy/" title="Github Name Squatting Policy">Github Name Squatting Policy</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2014 Nikhil Kumar. Powered by <a href="http://jekyllrb.com">Jekyll</a></span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

	        

</body>
</html>
